<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Slideshow: Cybermobbing</title>
    <style>
        body {
            margin: 0;
            background-color: black;
            color: white;
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        #media-container {
            max-width: 90vw;
            max-height: 70vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        img, iframe {
            max-width: 100%;
            max-height: 100%;
            border: 2px solid white;
            background:#000;
        }
        .controls {
            margin-top: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="media-container" aria-live="polite"></div>
    <div class="controls">
        <button onclick="prev()">Zurück</button>
        <button onclick="next()">Weiter</button>
        <button onclick="goToMap()">Zurück zur Karte</button>
    </div>

    <script>
        const slides = [
            "Folie1.jpeg",
            "yt|MzJD55HNXvA|406",
            "Folie2.jpeg"
        ];

        let current = 0;

        function buildYouTubeIframe(videoId, start, end) {
            const params = new URLSearchParams({
                rel: 0,
                modestbranding: 1,
                controls: 1,
                start: start || 0
            });
            if (end) params.set('end', end);
            const src = `https://www.youtube.com/embed/${videoId}?` + params.toString();
            const iframe = document.createElement('iframe');
            iframe.width = 960;
            iframe.height = 540;
            iframe.src = src;
            iframe.title = "YouTube video player";
            iframe.setAttribute('allow', 'accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share');
            iframe.setAttribute('allowfullscreen', 'true');
            return iframe;
        }

        function createImageWithFallback(src) {
            const img = document.createElement('img');
            const candidates = [src];

            if (src.toLowerCase().endsWith('.jpeg')) {
                candidates.push(src.replace(/\.jpeg$/i, '.jpg'));
                candidates.push(src.replace(/\.jpeg$/i, '.png'));
            } else if (src.toLowerCase().endsWith('.jpg')) {
                candidates.push(src.replace(/\.jpg$/i, '.jpeg'));
                candidates.push(src.replace(/\.jpg$/i, '.png'));
            } else if (src.toLowerCase().endsWith('.png')) {
                candidates.push(src.replace(/\.png$/i, '.jpg'));
                candidates.push(src.replace(/\.png$/i, '.jpeg'));
            }

            candidates.slice(0).forEach(s => candidates.push('images/' + s));
            candidates.slice(0).forEach(s => candidates.push('./' + s));

            let idx = 0;
            function tryNext() {
                if (idx >= candidates.length) {
                    img.alt = "Bild nicht gefunden: " + src;
                    return;
                }
                img.src = candidates[idx++];
            }
            img.onerror = tryNext;
            tryNext();
            return img;
        }

        function showSlide(index) {
            const container = document.getElementById('media-container');
            container.innerHTML = '';
            const file = slides[index];

            if (typeof file === 'string' && file.startsWith('yt|')) {
                const parts = file.split('|');
                const vid = parts[1];
                const start = parts[2] ? parseInt(parts[2], 10) : 0;
                const end = parts[3] ? parseInt(parts[3], 10) : undefined;
                container.appendChild(buildYouTubeIframe(vid, start, end));
            } else if (typeof file === 'string') {
                container.appendChild(createImageWithFallback(file));
            } else {
                const p = document.createElement('p');
                p.textContent = 'Unbekanntes Slide-Format';
                container.appendChild(p);
            }
        }

        function next() {
            if (current < slides.length - 1) {
                current++;
                showSlide(current);
            }
        }

        function prev() {
            if (current > 0) {
                current--;
                showSlide(current);
            }
        }

        function goToMap() {
            if (document.referrer) {
                history.back();
            } else {
                window.location.href = '../index.html';
            }
        }

        showSlide(current);
    </script>
</body>
</html>